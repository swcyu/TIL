## MySQL - L4.
- 저자 별 카테고리 별 매출액 집계하기
```sql 

-- 서브쿼리 사용
SELECT B.AUTHOR_ID, A.AUTHOR_NAME, B.CATEGORY, SUM(TOT_SALES * B.PRICE) AS TOTAL_SALES
FROM BOOK B JOIN AUTHOR A
ON B.AUTHOR_ID = A.AUTHOR_ID
JOIN (SELECT BOOK_ID, DATE_FORMAT(SALES_DATE, '%Y-%m'), SUM(SALES) AS TOT_SALES
FROM BOOK_SALES
WHERE DATE_FORMAT(SALES_DATE, '%Y-%m') = '2022-01'
GROUP BY 1, 2) BS
ON BS.BOOK_ID = B.BOOK_ID
GROUP BY B.AUTHOR_ID, A.AUTHOR_NAME, B.CATEGORY
ORDER BY B.AUTHOR_ID ASC, B.CATEGORY DESC;

-- INNER JOIN 3번 
SELECT B.AUTHOR_ID, A.AUTHOR_NAME, B.CATEGORY, SUM(SALES * PRICE) AS TOTAL_SALES FROM BOOK B INNER JOIN AUTHOR A ON B.AUTHOR_ID = A.AUTHOR_ID INNER JOIN BOOK_SALES BS ON B.BOOK_ID = BS.BOOK_ID WHERE DATE_FORMAT(SALES_DATE, '%Y-%m') = '2022-01' GROUP BY B.AUTHOR_ID, B.CATEGORY ORDER BY B.AUTHOR_ID, B.CATEGORY DESC;

----

-- N딩: 서브쿼리 GROUP BY, 첫째 줄 SUM 참고
SELECT A.AUTHOR_ID,B.AUTHOR_NAME,A.CATEGORY,SUM(A.PRICE*TOTAL_SALES) AS SALES
FROM BOOK A JOIN AUTHOR B 
ON A.AUTHOR_ID=B.AUTHOR_ID
JOIN (SELECT BOOK_ID,DATE_FORMAT(SALES_DATE,"%Y-%m"),SUM(SALES) AS TOTAL_SALES
FROM BOOK_SALES 
WHERE DATE_FORMAT(SALES_DATE,"%Y-%m")='2022-01'
GROUP BY 1,2)C ON A.BOOK_ID=C.BOOK_ID
GROUP BY A.AUTHOR_ID,B.AUTHOR_NAME,A.CATEGORY 
ORDER BY A.AUTHOR_ID ASC,A.CATEGORY DESC

-- waryong###: inner join 3개로
SELECT A.AUTHOR_ID, A.AUTHOR_NAME, B.CATEGORY,SUM(B.PRICE*BS.SALES) AS TOTAL_SALES
FROM BOOK AS B INNER JOIN AUTHOR AS A ON B.AUTHOR_ID = A.AUTHOR_ID INNER JOIN BOOK_SALES AS BS ON B.BOOK_ID=BS.BOOK_ID
WHERE BS.SALES_DATE LIKE '%2022-01%'
GROUP BY B.AUTHOR_ID,B.CATEGORY
ORDER BY A.AUTHOR_ID ASC, B.CATEGORY DESC
```




